<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Agent â€” Zeb Autonomous Optimization</title>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --lime: #D1FF79; --green: #8EFF79; --blue: #97B2FF; --yellow: #FFEA79;
            --pink: #FF798E; --orange: #FFA779; --dark: #000000; --charcoal: #3B4240;
            --gray: #717D7A; --bg: #0a0c0b; --card: rgba(59,66,64,0.15);
            --border: rgba(209,255,121,0.08); --text: #e8ebe9; --muted: #717D7A;
        }
        body {
            background: var(--bg); color: var(--text); font-family: 'Figtree', sans-serif;
            min-height: 100vh; overflow: hidden;
        }
        body::before {
            content: ''; position: fixed; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(ellipse at 20% 20%, rgba(209,255,121,0.04) 0%, transparent 50%),
                        radial-gradient(ellipse at 80% 80%, rgba(151,178,255,0.03) 0%, transparent 50%),
                        radial-gradient(ellipse at 50% 50%, rgba(142,255,121,0.02) 0%, transparent 60%);
            animation: bgFloat 20s ease-in-out infinite;
            z-index: 0; pointer-events: none;
        }
        @keyframes bgFloat {
            0%,100% { transform: translate(0,0) rotate(0deg); }
            33% { transform: translate(2%,-2%) rotate(1deg); }
            66% { transform: translate(-1%,1%) rotate(-0.5deg); }
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(209,255,121,0.15); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(209,255,121,0.3); }

        /* â”€â”€ Animations â”€â”€ */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes glow { 0%,100% { box-shadow: 0 0 5px rgba(209,255,121,0.1); } 50% { box-shadow: 0 0 20px rgba(209,255,121,0.2), 0 0 40px rgba(209,255,121,0.05); } }
        @keyframes neonPulse { 0%,100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { background-position: -200% center; } 100% { background-position: 200% center; } }
        @keyframes borderGlow {
            0%,100% { border-color: rgba(209,255,121,0.15); }
            50% { border-color: rgba(209,255,121,0.35); }
        }
        @keyframes floatUp { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        @keyframes progressPulse { 0%,100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes textReveal { from { opacity: 0; filter: blur(4px); } to { opacity: 1; filter: blur(0); } }

        .fade-up { animation: fadeUp 0.6s cubic-bezier(0.16,1,0.3,1); }
        .fade-in { animation: fadeIn 0.4s ease; }
        .scale-in { animation: scaleIn 0.5s cubic-bezier(0.16,1,0.3,1); }

        /* â”€â”€ Layout â”€â”€ */
        .app { display: flex; min-height: 100vh; position: relative; z-index: 1; }

        /* â”€â”€ Sidebar â”€â”€ */
        .sidebar {
            width: 260px; padding: 24px 16px; display: flex; flex-direction: column; flex-shrink: 0;
            background: rgba(10,12,11,0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid rgba(209,255,121,0.06);
            position: relative; z-index: 2;
        }
        .sidebar::after {
            content: ''; position: absolute; top: 0; right: 0; width: 1px; height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(209,255,121,0.15), transparent);
        }
        .main { flex: 1; padding: 28px 36px; overflow-y: auto; max-height: 100vh; position: relative; z-index: 1; }

        /* â”€â”€ Logo â”€â”€ */
        .logo {
            font-size: 22px; font-weight: 800; margin-bottom: 32px; display: flex;
            align-items: center; gap: 10px; padding: 4px 0; letter-spacing: -0.5px;
        }
        .logo-icon {
            width: 36px; height: 36px; border-radius: 10px;
            background: linear-gradient(135deg, var(--lime), var(--green));
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; font-weight: 900; color: var(--dark);
            box-shadow: 0 0 15px rgba(209,255,121,0.2);
            animation: glow 3s ease-in-out infinite;
        }
        .logo-text { color: #fff; }
        .logo-sub { color: var(--lime); font-weight: 700; }

        /* â”€â”€ Nav â”€â”€ */
        .nav-section {
            font-size: 9px; color: var(--muted); text-transform: uppercase;
            letter-spacing: 3px; margin: 20px 0 10px 14px; font-weight: 700;
        }
        .nav-item {
            padding: 11px 14px; border-radius: 12px; cursor: pointer; display: flex;
            align-items: center; gap: 12px; margin-bottom: 3px; font-size: 13px;
            color: var(--muted); transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
            position: relative; font-weight: 500;
        }
        .nav-item:hover {
            background: rgba(209,255,121,0.04); color: var(--text);
            transform: translateX(4px);
        }
        .nav-item.active {
            background: rgba(209,255,121,0.08); color: var(--lime); font-weight: 700;
            box-shadow: inset 3px 0 0 var(--lime);
        }
        .nav-item.active::before {
            content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
            width: 3px; height: 20px; background: var(--lime); border-radius: 0 3px 3px 0;
        }
        .nav-icon { font-size: 16px; flex-shrink: 0; filter: grayscale(0.3); }
        .nav-item.active .nav-icon { filter: none; }

        /* â”€â”€ Glass Cards â”€â”€ */
        .card {
            background: rgba(59,66,64,0.12); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(209,255,121,0.06); border-radius: 16px;
            padding: 24px; margin-bottom: 16px; transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
        }
        .card:hover { border-color: rgba(209,255,121,0.12); }
        .card-highlight {
            background: linear-gradient(135deg, rgba(209,255,121,0.04), rgba(151,178,255,0.04));
            border-color: rgba(209,255,121,0.12);
            animation: borderGlow 4s ease-in-out infinite;
        }
        .card-glow {
            box-shadow: 0 0 20px rgba(209,255,121,0.05), 0 8px 32px rgba(0,0,0,0.3);
        }

        /* â”€â”€ Neon Border Effect â”€â”€ */
        .neon-border {
            position: relative; overflow: hidden;
        }
        .neon-border::before {
            content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, var(--lime), var(--blue), var(--pink), var(--orange), var(--lime));
            background-size: 400% 400%; border-radius: 18px; z-index: -1;
            animation: shimmer 6s ease infinite; opacity: 0.3;
        }

        /* â”€â”€ Inputs â”€â”€ */
        input[type="text"], input[type="email"], input[type="password"], input[type="url"], input[type="number"] {
            width: 100%; padding: 14px 18px; background: rgba(59,66,64,0.2);
            border: 1px solid rgba(209,255,121,0.08); border-radius: 12px;
            color: #fff; font-size: 14px; font-family: 'Figtree', sans-serif;
            transition: all 0.3s cubic-bezier(0.16,1,0.3,1); backdrop-filter: blur(8px);
        }
        input:focus {
            outline: none; border-color: var(--lime);
            box-shadow: 0 0 0 3px rgba(209,255,121,0.1), 0 0 20px rgba(209,255,121,0.05);
        }
        input::placeholder { color: rgba(113,125,122,0.6); }

        /* â”€â”€ Buttons â”€â”€ */
        .btn {
            padding: 12px 28px; border: none; border-radius: 12px; cursor: pointer;
            font-size: 14px; font-weight: 700; font-family: 'Figtree', sans-serif;
            letter-spacing: 0.3px; transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
            position: relative; overflow: hidden;
        }
        .btn::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
            opacity: 0; transition: opacity 0.3s;
        }
        .btn:hover::after { opacity: 1; }
        .btn-primary {
            background: linear-gradient(135deg, var(--lime), var(--green));
            color: var(--dark); font-weight: 800;
            box-shadow: 0 4px 15px rgba(209,255,121,0.15);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(209,255,121,0.25), 0 0 40px rgba(209,255,121,0.1);
        }
        .btn-primary:active { transform: translateY(0); }
        .btn-secondary {
            background: rgba(59,66,64,0.3); color: var(--text);
            border: 1px solid rgba(209,255,121,0.1); backdrop-filter: blur(8px);
        }
        .btn-secondary:hover { border-color: rgba(209,255,121,0.25); background: rgba(59,66,64,0.5); }
        .btn-sm { padding: 8px 18px; font-size: 12px; }

        /* â”€â”€ Labels â”€â”€ */
        .label { font-size: 11px; color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; font-weight: 600; }
        .section-title {
            font-size: 11px; color: var(--muted); text-transform: uppercase;
            letter-spacing: 3px; margin-bottom: 16px; font-weight: 700;
        }

        /* â”€â”€ Badges â”€â”€ */
        .badge {
            display: inline-block; padding: 3px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 700; letter-spacing: 0.5px;
        }
        .badge-green { color: var(--lime); background: rgba(209,255,121,0.08); border: 1px solid rgba(209,255,121,0.15); }
        .badge-red { color: var(--pink); background: rgba(255,121,142,0.08); border: 1px solid rgba(255,121,142,0.15); }
        .badge-yellow { color: var(--yellow); background: rgba(255,234,121,0.08); border: 1px solid rgba(255,234,121,0.15); }
        .badge-blue { color: var(--blue); background: rgba(151,178,255,0.08); border: 1px solid rgba(151,178,255,0.15); }

        /* â”€â”€ Stats â”€â”€ */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
        .stat-card { text-align: center; position: relative; }
        .stat-value { font-size: 32px; font-weight: 800; letter-spacing: -1px; }
        .stat-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 6px; font-weight: 600; }

        /* â”€â”€ Module Grid â”€â”€ */
        .module-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 14px; }
        .module-card {
            cursor: pointer; transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
            position: relative;
        }
        .module-card:hover {
            transform: translateY(-4px);
            border-color: rgba(209,255,121,0.2);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3), 0 0 20px rgba(209,255,121,0.05);
        }
        .module-icon { font-size: 28px; margin-bottom: 10px; filter: drop-shadow(0 0 8px rgba(209,255,121,0.2)); }
        .module-name { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
        .module-desc { font-size: 11px; color: var(--muted); line-height: 1.5; }

        /* â”€â”€ Progress â”€â”€ */
        .progress-bar {
            width: 100%; height: 6px; background: rgba(59,66,64,0.3);
            border-radius: 10px; overflow: hidden; position: relative;
        }
        .progress-fill {
            height: 100%; border-radius: 10px;
            background: linear-gradient(90deg, var(--lime), var(--green), var(--blue));
            background-size: 200% 100%; animation: shimmer 3s ease infinite;
            transition: width 0.8s cubic-bezier(0.16,1,0.3,1);
            box-shadow: 0 0 10px rgba(209,255,121,0.3);
        }

        /* â”€â”€ Spinner â”€â”€ */
        .spinner {
            width: 20px; height: 20px; border: 2px solid rgba(209,255,121,0.2);
            border-top-color: var(--lime); border-radius: 50%;
            animation: spin 0.8s linear infinite; display: inline-block;
        }

        /* â”€â”€ Agent Log â”€â”€ */
        .log-entry {
            display: flex; gap: 10px; padding: 6px 0;
            border-bottom: 1px solid rgba(209,255,121,0.03);
            font-size: 12px; animation: slideIn 0.3s cubic-bezier(0.16,1,0.3,1);
        }
        .log-time { color: var(--charcoal); font-size: 10px; font-family: 'JetBrains Mono', monospace; min-width: 65px; }
        .log-agent { font-weight: 700; min-width: 75px; }

        /* â”€â”€ Page Items â”€â”€ */
        .page-item {
            cursor: pointer; padding: 16px; margin-bottom: 8px;
            transition: all 0.3s cubic-bezier(0.16,1,0.3,1);
        }
        .page-item:hover { border-color: rgba(209,255,121,0.2); transform: translateX(4px); }
        .page-path { font-size: 13px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }

        /* â”€â”€ Before/After â”€â”€ */
        .before-box {
            padding: 12px 14px; background: rgba(255,121,142,0.04); border-radius: 10px;
            border: 1px solid rgba(255,121,142,0.1); font-size: 12px;
        }
        .after-box {
            padding: 12px 14px; background: rgba(209,255,121,0.03); border-radius: 10px;
            border: 1px solid rgba(209,255,121,0.1); font-size: 12px;
        }

        /* â”€â”€ Two/Three Column â”€â”€ */
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

        /* â”€â”€ Login â”€â”€ */
        .login-wrapper {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            background: var(--bg); position: relative; overflow: hidden;
        }
        .login-wrapper::before {
            content: ''; position: absolute; width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(209,255,121,0.06) 0%, transparent 60%);
            top: -100px; right: -100px; animation: floatUp 8s ease-in-out infinite;
        }
        .login-wrapper::after {
            content: ''; position: absolute; width: 500px; height: 500px;
            background: radial-gradient(circle, rgba(151,178,255,0.04) 0%, transparent 60%);
            bottom: -100px; left: -100px; animation: floatUp 10s ease-in-out infinite reverse;
        }
        .login-box {
            width: 440px; background: rgba(15,18,16,0.8); backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
            border: 1px solid rgba(209,255,121,0.08); border-radius: 24px; padding: 48px;
            animation: scaleIn 0.7s cubic-bezier(0.16,1,0.3,1);
            box-shadow: 0 25px 80px rgba(0,0,0,0.5), 0 0 40px rgba(209,255,121,0.03);
            position: relative; z-index: 1;
        }
        .login-title {
            font-size: 36px; font-weight: 900; text-align: center; margin-bottom: 4px;
            letter-spacing: -2px;
        }
        .login-sub {
            font-size: 11px; color: var(--muted); letter-spacing: 4px;
            text-transform: uppercase; text-align: center; margin-bottom: 40px; font-weight: 600;
        }

        /* â”€â”€ Score â”€â”€ */
        .score-number { font-size: 24px; font-weight: 800; letter-spacing: -0.5px; }

        /* â”€â”€ Verdict â”€â”€ */
        .verdict {
            text-align: center; margin-top: 24px; padding: 24px;
            background: rgba(209,255,121,0.03); border-radius: 16px;
            border: 1px solid rgba(209,255,121,0.08);
        }
        .verdict-text { font-size: 15px; font-weight: 700; color: var(--lime); margin-bottom: 8px; }
        .verdict-sub { font-size: 12px; color: var(--muted); }

        /* â”€â”€ User Info â”€â”€ */
        .user-info {
            padding: 14px; border-radius: 14px; background: rgba(59,66,64,0.1);
            border: 1px solid rgba(209,255,121,0.04); display: flex;
            align-items: center; gap: 12px; transition: all 0.3s;
        }
        .user-info:hover { border-color: rgba(209,255,121,0.1); }
        .user-avatar {
            width: 32px; height: 32px; border-radius: 10px;
            background: linear-gradient(135deg, var(--lime), var(--blue));
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 800; color: var(--dark);
            box-shadow: 0 0 10px rgba(209,255,121,0.15);
        }
        .user-name { font-size: 13px; font-weight: 700; }
        .user-email { font-size: 10px; color: var(--muted); }

        /* â”€â”€ Opportunity â”€â”€ */
        .opportunity { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(209,255,121,0.04); font-size: 13px; }
        .check-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid rgba(209,255,121,0.04); font-size: 13px; }

        /* â”€â”€ Agent Status Cards â”€â”€ */
        .agent-card {
            padding: 14px; border-radius: 14px;
            background: rgba(59,66,64,0.08); backdrop-filter: blur(8px);
            text-align: center; transition: all 0.4s cubic-bezier(0.16,1,0.3,1);
            border: 1px solid transparent;
        }
        .agent-card.active { animation: borderGlow 2s ease-in-out infinite; }
        .agent-card .agent-icon { font-size: 24px; margin-bottom: 6px; }
        .agent-card .agent-name { font-size: 12px; font-weight: 700; }
        .agent-card .agent-status { font-size: 10px; color: var(--muted); margin-top: 2px; }

        .hidden { display: none !important; }

        /* â”€â”€ Stagger Animations â”€â”€ */
        .stagger-1 { animation-delay: 0.05s; }
        .stagger-2 { animation-delay: 0.1s; }
        .stagger-3 { animation-delay: 0.15s; }
        .stagger-4 { animation-delay: 0.2s; }
        .stagger-5 { animation-delay: 0.25s; }
        .stagger-6 { animation-delay: 0.3s; }
    </style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="login-wrapper">
    <div class="login-box">
        <div class="login-title"><span style="color:var(--lime)">â—† SEO</span><span>Agent</span></div>
        <div class="login-sub">Autonomous Optimization</div>

        <div id="signupFields">
            <div class="label">Full Name</div>
            <input type="text" id="nameInput" placeholder="John Doe" style="margin-bottom:16px">
        </div>
        <div class="label">Email</div>
        <input type="email" id="emailInput" placeholder="you@company.com" style="margin-bottom:16px">
        <div class="label">Password</div>
        <input type="password" id="passwordInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="margin-bottom:28px">

        <button class="btn btn-primary" style="width:100%;padding:16px;font-size:15px" onclick="handleAuth()" id="authBtn">Sign Up</button>

        <div style="text-align:center;margin-top:24px">
            <span style="color:var(--muted);font-size:13px" id="authToggleText">Already have an account? </span>
            <span style="color:var(--lime);font-size:13px;cursor:pointer;font-weight:700" onclick="toggleAuth()" id="authToggleLink">Sign In</span>
        </div>
        <div id="authError" style="color:var(--pink);font-size:12px;text-align:center;margin-top:12px"></div>
    </div>
</div>

<!-- MAIN APP -->
<div id="appScreen" class="app hidden">
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">Z</div>
            <div><span class="logo-text">SEO </span><span class="logo-sub">Agent</span></div>
        </div>

        <div style="flex:1">
            <div class="nav-section">Workflow</div>
            <div class="nav-item active" data-screen="dashboard" onclick="showScreen('dashboard')"><span class="nav-icon">âŒ‚</span> Dashboard</div>
            <div class="nav-item" data-screen="audit" onclick="showScreen('audit')"><span class="nav-icon">ğŸ”</span> SEO Audit</div>
            <div class="nav-item" data-screen="fix" onclick="showScreen('fix')"><span class="nav-icon">ğŸ”§</span> Auto Fix</div>
            <div class="nav-item" data-screen="decide" onclick="showScreen('decide')"><span class="nav-icon">ğŸ¤”</span> Decide</div>
            <div class="nav-item" data-screen="review" onclick="showScreen('review')"><span class="nav-icon">ğŸ“‹</span> Review</div>
            <div class="nav-item" data-screen="report" onclick="showScreen('report')"><span class="nav-icon">ğŸ“„</span> Final Report</div>

            <div class="nav-section" style="margin-top:20px">Modules</div>
            <div class="nav-item" onclick="showModule('geo')"><span class="nav-icon">ğŸŒ</span> GEO Optimization</div>
            <div class="nav-item" onclick="showModule('brand')"><span class="nav-icon">ğŸ›¡ï¸</span> AI Brand Monitor</div>
            <div class="nav-item" onclick="showModule('zeroclick')"><span class="nav-icon">ğŸ¯</span> Zero-Click SEO</div>
            <div class="nav-item" onclick="showModule('eeat')"><span class="nav-icon">âœ…</span> EEAT Analyser</div>
            <div class="nav-item" onclick="showModule('contentquality')"><span class="nav-icon">ğŸ“</span> Content Quality</div>
            <div class="nav-item" onclick="showModule('predictive')"><span class="nav-icon">ğŸ”®</span> Predictive SEO</div>
        </div>

        <div class="user-info">
            <div class="user-avatar" id="userAvatar">U</div>
            <div>
                <div class="user-name" id="userName">User</div>
                <div class="user-email" id="userEmail">user@zeb.co</div>
            </div>
        </div>
    </div>

    <div class="main" id="mainContent"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API = window.location.origin.includes("file://") ? "http://localhost:8000" : "";
let token = "";
let user = null;
let isSignup = true;
let currentProject = null;
let projectData = null;
let reportData = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleAuth() {
    isSignup = !isSignup;
    document.getElementById("signupFields").classList.toggle("hidden", !isSignup);
    document.getElementById("authBtn").textContent = isSignup ? "Sign Up" : "Sign In";
    document.getElementById("authToggleText").textContent = isSignup ? "Already have an account? " : "Don't have an account? ";
    document.getElementById("authToggleLink").textContent = isSignup ? "Sign In" : "Sign Up";
    document.getElementById("authError").textContent = "";
}

async function handleAuth() {
    const email = document.getElementById("emailInput").value;
    const password = document.getElementById("passwordInput").value;
    const name = document.getElementById("nameInput").value;
    if (!email || !password) { document.getElementById("authError").textContent = "Please fill all fields"; return; }
    const endpoint = isSignup ? "/api/auth/signup" : "/api/auth/login";
    const body = isSignup ? { email, password, name } : { email, password };
    try {
        const res = await fetch(API + endpoint, {
            method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(body)
        });
        const data = await res.json();
        if (res.ok) {
            token = data.access_token; user = data.user;
            document.getElementById("loginScreen").classList.add("hidden");
            document.getElementById("appScreen").classList.remove("hidden");
            document.getElementById("userName").textContent = user.name;
            document.getElementById("userEmail").textContent = user.email;
            document.getElementById("userAvatar").textContent = user.name[0].toUpperCase();
            showScreen("dashboard");
        } else {
            document.getElementById("authError").textContent = data.detail || "Error occurred";
        }
    } catch (e) {
        document.getElementById("authError").textContent = "Cannot connect to server. Is the backend running?";
    }
}

function api(path, options = {}) {
    return fetch(API + path, {
        ...options,
        headers: { "Authorization": "Bearer " + token, "Content-Type": "application/json", ...options.headers }
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(name) {
    document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("active"));
    const navItem = document.querySelector('.nav-item[data-screen="' + name + '"]');
    if (navItem) navItem.classList.add("active");
    const screens = { dashboard: renderDashboard, audit: renderAudit, fix: renderFix, decide: renderDecide, review: renderReview, report: renderReport };
    if (screens[name]) screens[name]();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
    const main = document.getElementById("mainContent");
    main.innerHTML = `
        <div class="fade-up">
            <h1 style="font-size:30px;font-weight:900;margin-bottom:4px;letter-spacing:-1px;animation:textReveal 0.8s ease">
                Welcome back, <span style="background:linear-gradient(135deg,var(--lime),var(--green));-webkit-background-clip:text;-webkit-text-fill-color:transparent">${user?.name || 'User'}</span>
            </h1>
            <p style="color:var(--muted);font-size:14px;margin-bottom:36px">Launch a crawl to begin your autonomous SEO audit.</p>

            <div class="card card-highlight card-glow neon-border">
                <div class="section-title" style="color:var(--lime)">â—† Autonomous SEO Audit</div>
                <div style="display:flex;gap:14px;align-items:center">
                    <input type="url" id="crawlUrl" placeholder="Enter any website URL (e.g., avasoft.com)" style="flex:1;padding:16px 20px;font-size:15px">
                    <button class="btn btn-primary" onclick="startCrawl()" id="crawlBtn" style="padding:16px 40px;font-size:15px;white-space:nowrap">
                        ğŸ¤– Auto Audit
                    </button>
                </div>
                <input type="hidden" id="crawlPages" value="200">
                <div style="color:var(--muted);font-size:11px;margin-top:10px;letter-spacing:0.5px">The agent will automatically discover and audit ALL pages on your site</div>
                <div style="display:flex;gap:20px;margin-top:20px">
                    <div class="agent-card" style="flex:1;border:1px solid rgba(151,178,255,0.1)">
                        <div class="agent-icon">ğŸ§ </div>
                        <div class="agent-name" style="color:var(--blue)">Planner</div>
                        <div class="agent-status"><span class="badge badge-green" style="font-size:9px">Ready</span></div>
                    </div>
                    <div class="agent-card" style="flex:1;border:1px solid rgba(255,234,121,0.1)">
                        <div class="agent-icon">ğŸ”</div>
                        <div class="agent-name" style="color:var(--yellow)">Auditor</div>
                        <div class="agent-status"><span class="badge badge-green" style="font-size:9px">Ready</span></div>
                    </div>
                    <div class="agent-card" style="flex:1;border:1px solid rgba(142,255,121,0.1)">
                        <div class="agent-icon">ğŸ”§</div>
                        <div class="agent-name" style="color:var(--green)">Fixer</div>
                        <div class="agent-status"><span class="badge badge-green" style="font-size:9px">Ready</span></div>
                    </div>
                    <div class="agent-card" style="flex:1;border:1px solid rgba(255,121,142,0.1)">
                        <div class="agent-icon">ğŸ“‹</div>
                        <div class="agent-name" style="color:var(--pink)">Reviewer</div>
                        <div class="agent-status"><span class="badge badge-green" style="font-size:9px">Ready</span></div>
                    </div>
                </div>
            </div>

            <div id="projectsList" style="margin-top:32px"></div>

            <div class="section-title" style="margin-top:36px">SEO Modules</div>
            <div class="module-grid">
                ${[
                    {id:"geo",icon:"ğŸŒ",name:"GEO Optimization",desc:"Generative Engine Optimization for AI search"},
                    {id:"brand",icon:"ğŸ›¡ï¸",name:"AI Brand Monitor",desc:"Track brand mentions across AI platforms"},
                    {id:"zeroclick",icon:"ğŸ¯",name:"Zero-Click SEO",desc:"Featured snippets & direct answers"},
                    {id:"eeat",icon:"âœ…",name:"EEAT Signal Analyser",desc:"Experience, Expertise, Authority, Trust"},
                    {id:"contentquality",icon:"ğŸ“",name:"Content Quality",desc:"AI-powered content assessment"},
                    {id:"predictive",icon:"ğŸ”®",name:"Predictive SEO",desc:"Forecast ranking changes"},
                    {id:"commerce",icon:"ğŸ›’",name:"Agentic Commerce",desc:"Commerce readiness for AI shopping"},
                    {id:"competitor",icon:"ğŸ“Š",name:"Competitor Benchmarking",desc:"AI visibility competitive analysis"},
                    {id:"searcheverywhere",icon:"ğŸ”",name:"Search Everywhere",desc:"Multi-platform search presence"},
                    {id:"topicclusters",icon:"ğŸ§©",name:"Topic Clusters",desc:"Content clustering & pillar strategy"},
                ].map((m,i) => `
                    <div class="card module-card fade-up stagger-${Math.min(i+1,6)}" onclick="showModule('${m.id}')" style="animation-fill-mode:both">
                        <div class="module-icon">${m.icon}</div>
                        <div class="module-name">${m.name}</div>
                        <div class="module-desc">${m.desc}</div>
                    </div>
                `).join("")}
            </div>
        </div>
    `;
    loadProjects();
}

async function loadProjects() {
    try {
        const res = await api("/api/projects");
        const projects = await res.json();
        const el = document.getElementById("projectsList");
        if (projects.length === 0) { el.innerHTML = ""; return; }
        el.innerHTML = `
            <div class="section-title">Previous Crawls</div>
            ${projects.map((p,i) => `
                <div class="card page-item fade-up stagger-${Math.min(i+1,6)}" onclick="loadProject(${p.id})" style="display:flex;justify-content:space-between;align-items:center;animation-fill-mode:both">
                    <div>
                        <div class="page-path">${p.url}</div>
                        <div style="font-size:11px;color:var(--muted);margin-top:4px">
                            ${p.total_pages} pages Â· ${p.total_issues} issues Â· Status: ${p.status}
                        </div>
                    </div>
                    <div style="text-align:right;display:flex;align-items:center;gap:16px">
                        <div style="font-size:24px;font-weight:800;color:${p.avg_score_after >= 70 ? 'var(--lime)' : 'var(--yellow)'};letter-spacing:-1px">${p.avg_score_after}%</div>
                        <span class="badge ${p.status === 'complete' ? 'badge-green' : 'badge-yellow'}">${p.status}</span>
                    </div>
                </div>
            `).join("")}
        `;
    } catch(e) { console.error(e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CRAWL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startCrawl() {
    const url = document.getElementById("crawlUrl").value;
    const maxPages = document.getElementById("crawlPages").value;
    if (!url) return;

    showScreen("crawling");
    document.getElementById("mainContent").innerHTML = `
        <div class="fade-up">
            <h2 style="font-size:24px;font-weight:900;margin-bottom:28px;letter-spacing:-0.5px">ğŸ¤– SEO Agent Running Autonomously...</h2>
            <div class="card card-highlight card-glow" style="margin-bottom:20px">
                <div style="display:flex;justify-content:space-between;margin-bottom:14px">
                    <span style="color:var(--lime);font-size:13px;font-weight:700" id="crawlPhase">ğŸš€ Starting pipeline for ${url}</span>
                    <span style="color:var(--muted);font-size:13px;font-family:'JetBrains Mono',monospace;font-weight:600" id="crawlPct">0%</span>
                </div>
                <div class="progress-bar"><div class="progress-fill" id="crawlProgress" style="width:0%"></div></div>
                <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:24px">
                    <div class="agent-card" style="border:1px solid rgba(151,178,255,0.1)">
                        <div style="font-size:24px">ğŸ§ </div>
                        <div style="font-size:12px;color:var(--blue);font-weight:700">Planner</div>
                        <div style="font-size:10px;color:var(--muted)" id="plannerStatus">Waiting...</div>
                    </div>
                    <div class="agent-card" style="border:1px solid rgba(255,234,121,0.1)">
                        <div style="font-size:24px">ğŸ”</div>
                        <div style="font-size:12px;color:var(--yellow);font-weight:700">Auditor</div>
                        <div style="font-size:10px;color:var(--muted)" id="auditorStatus">Waiting...</div>
                    </div>
                    <div class="agent-card" style="border:1px solid rgba(142,255,121,0.1)">
                        <div style="font-size:24px">ğŸ”§</div>
                        <div style="font-size:12px;color:var(--green);font-weight:700">Fixer</div>
                        <div style="font-size:10px;color:var(--muted)" id="fixerStatus">Waiting...</div>
                    </div>
                    <div class="agent-card" style="border:1px solid rgba(255,121,142,0.1)">
                        <div style="font-size:24px">ğŸ“‹</div>
                        <div style="font-size:12px;color:var(--pink);font-weight:700">Reviewer</div>
                        <div style="font-size:10px;color:var(--muted)" id="reviewerStatus">Waiting...</div>
                    </div>
                </div>
            </div>
            <div class="card" style="max-height:350px;overflow-y:auto" id="liveLogPanel">
                <div class="section-title">ğŸ¤– Live Agent Activity</div>
                <div id="liveLog"></div>
            </div>
        </div>
    `;

    try {
        const res = await api("/api/projects/crawl", {
            method: "POST", body: JSON.stringify({ url, max_pages: parseInt(maxPages) })
        });
        const data = await res.json();
        currentProject = data.project_id;
        addLiveLog("Planner", "Pipeline initiated for " + url, "start");
        document.getElementById("plannerStatus").textContent = "Running...";

        const interval = setInterval(async () => {
            try {
                const check = await api("/api/projects/" + currentProject);
                const proj = await check.json();
                const s = proj.status;
                if (s === "crawling") {
                    document.getElementById("crawlProgress").style.width = "30%";
                    document.getElementById("crawlPct").textContent = "30%";
                    document.getElementById("crawlPhase").textContent = "ğŸ” Auditor crawling pages...";
                    document.getElementById("plannerStatus").textContent = "âœ… Done";
                    document.getElementById("auditorStatus").textContent = "Running...";
                } else if (s === "auditing") {
                    document.getElementById("crawlProgress").style.width = "50%";
                    document.getElementById("crawlPct").textContent = "50%";
                    document.getElementById("crawlPhase").textContent = "ğŸ” Analyzing " + (proj.total_pages||0) + " pages...";
                    addLiveLog("Auditor", "Analyzing " + (proj.total_pages||0) + " pages", "info");
                } else if (s === "fixing") {
                    document.getElementById("crawlProgress").style.width = "70%";
                    document.getElementById("crawlPct").textContent = "70%";
                    document.getElementById("crawlPhase").textContent = "ğŸ”§ Fixer applying fixes...";
                    document.getElementById("auditorStatus").textContent = "âœ… Done";
                    document.getElementById("fixerStatus").textContent = "Running...";
                    addLiveLog("Fixer", "Auto-fixing " + (proj.total_issues||0) + " issues", "fix");
                } else if (s === "reviewing") {
                    document.getElementById("crawlProgress").style.width = "90%";
                    document.getElementById("crawlPct").textContent = "90%";
                    document.getElementById("crawlPhase").textContent = "ğŸ“‹ Reviewer validating...";
                    document.getElementById("fixerStatus").textContent = "âœ… Done";
                    document.getElementById("reviewerStatus").textContent = "Running...";
                } else if (s === "complete") {
                    clearInterval(interval);
                    document.getElementById("crawlProgress").style.width = "100%";
                    document.getElementById("crawlPct").textContent = "100%";
                    document.getElementById("crawlPhase").textContent = "âœ… Done! Loading results...";
                    document.getElementById("reviewerStatus").textContent = "âœ… Done";
                    addLiveLog("Planner", "Pipeline complete!", "success");
                    projectData = proj;
                    try { const rr = await api("/api/projects/" + currentProject + "/report"); reportData = await rr.json(); } catch(e) {}
                    setTimeout(() => { showScreen("audit"); }, 500);
                } else if (s === "error") {
                    clearInterval(interval);
                    document.getElementById("crawlPhase").textContent = "âŒ Error occurred";
                    addLiveLog("Planner", "Pipeline error", "error");
                }
            } catch(e) {}
        }, 2000);
    } catch(e) {
        addLiveLog("Planner", "Error: " + e.message, "error");
    }
}

function addLiveLog(agent, message, type) {
    const el = document.getElementById("liveLog");
    if (!el) return;
    const colors = { Planner: "var(--blue)", Auditor: "var(--yellow)", Fixer: "var(--green)", Reviewer: "var(--pink)" };
    const msgColors = { info: "var(--muted)", success: "var(--lime)", fix: "var(--green)", error: "var(--pink)", start: "var(--blue)", escalate: "var(--yellow)" };
    el.innerHTML += '<div class="log-entry"><span class="log-time">' + new Date().toLocaleTimeString() + '</span><span class="log-agent" style="color:' + (colors[agent]||'var(--muted)') + '">' + agent + '</span><span style="color:' + (msgColors[type]||'var(--muted)') + '">' + message + '</span></div>';
    el.scrollTop = el.scrollHeight;
}

async function loadProject(id) {
    currentProject = id;
    try { const res = await api("/api/projects/" + id); projectData = await res.json(); showScreen("audit"); } catch(e) { console.error(e); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIT SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAudit() {
    if (!projectData) { document.getElementById("mainContent").innerHTML = '<div class="card" style="text-align:center;padding:60px;color:var(--muted)">No crawl data yet. Go to Dashboard and start a crawl first.</div>'; return; }
    const pages = projectData.pages || [];
    const totalIssues = pages.reduce((s, p) => s + (p.issues?.length || 0), 0);
    const autoFix = pages.reduce((s, p) => s + (p.issues?.filter(i => i.auto_fixable)?.length || 0), 0);
    const needsHuman = totalIssues - autoFix;
    const totalFixes = pages.reduce((s, p) => s + (p.fixes?.length || 0), 0);
    const avgBefore = pages.length ? Math.round(pages.reduce((s,p) => s + p.score_before, 0) / pages.length) : 0;
    const avgAfter = pages.length ? Math.round(pages.reduce((s,p) => s + p.score_after, 0) / pages.length) : 0;

    document.getElementById("mainContent").innerHTML = `
        <div class="fade-up">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:28px">
                <div>
                    <h2 style="font-size:24px;font-weight:900;letter-spacing:-0.5px">ğŸ” Full SEO Audit</h2>
                    <p style="color:var(--muted);font-size:13px">${pages.length} pages crawled Â· ${totalIssues} issues found Â· ${totalFixes} auto-fixed</p>
                </div>
                <div style="display:flex;gap:10px">
                    <button class="btn btn-secondary" onclick="showScreen('fix')">ğŸ”§ Fixes Detail</button>
                    <button class="btn btn-primary" onclick="loadReport()">ğŸ“„ Full Report</button>
                </div>
            </div>

            <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:14px;margin-bottom:28px">
                ${[
                    {v:pages.length,l:"Pages",c:"var(--blue)"},{v:totalIssues,l:"Issues",c:"var(--pink)"},
                    {v:totalFixes,l:"Fixed",c:"var(--lime)"},{v:needsHuman,l:"Needs Human",c:"var(--yellow)"},
                    {v:avgBefore+"%",l:"Score Before",c:"var(--orange)"},{v:avgAfter+"%",l:"Score After",c:"var(--lime)"}
                ].map((s,i) => `
                    <div class="card stat-card scale-in stagger-${i+1}" style="animation-fill-mode:both">
                        <div class="stat-value" style="color:${s.c}">${s.v}</div>
                        <div class="stat-label">${s.l}</div>
                    </div>
                `).join("")}
            </div>

            <div class="card card-highlight" style="margin-bottom:28px">
                <div class="section-title" style="color:var(--lime)">ğŸ¤– Agent Auto-Actions Summary</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:12px">
                    <div>
                        <div style="font-size:13px;font-weight:700;color:var(--lime);margin-bottom:10px">âœ… What the Agent Fixed Automatically:</div>
                        ${pages.flatMap(p => (p.fixes || []).map(f => ({page: p.path, fix: f}))).map(item => `
                            <div style="font-size:12px;padding:5px 0;border-bottom:1px solid rgba(209,255,121,0.04)">
                                <span style="color:var(--lime)">âœ“</span>
                                <span style="color:var(--lime);font-family:'JetBrains Mono',monospace;font-size:11px">${item.page}</span>
                                â€” ${item.fix.type}: <span style="color:var(--muted)">${item.fix.before || '(empty)'}</span> â†’ <span style="color:var(--lime)">${item.fix.after || 'Fixed'}</span>
                            </div>
                        `).join("") || '<div style="color:var(--muted);font-size:12px">No auto-fixes applied</div>'}
                    </div>
                    <div>
                        <div style="font-size:13px;font-weight:700;color:var(--yellow);margin-bottom:10px">âš  Escalated to You:</div>
                        ${pages.flatMap(p => (p.escalations || []).map(e => ({page: p.path, esc: e}))).map(item => `
                            <div style="font-size:12px;padding:5px 0;border-bottom:1px solid rgba(255,234,121,0.04)">
                                <span style="color:var(--yellow)">âš </span>
                                <span style="color:var(--yellow);font-family:'JetBrains Mono',monospace;font-size:11px">${item.page}</span>
                                â€” ${item.esc.reason || item.esc.issue?.description || 'Needs review'}
                            </div>
                        `).join("") || '<div style="color:var(--muted);font-size:12px">Nothing escalated â€” all handled automatically!</div>'}
                    </div>
                </div>
            </div>

            <div class="section-title">ğŸ“‹ All Pages â€” Before & After</div>
            ${pages.map((p, i) => `
                <div class="card fade-up" style="margin-bottom:14px;border-color:${p.score_after >= 80 ? 'rgba(209,255,121,0.12)' : p.score_after >= 60 ? 'rgba(255,234,121,0.12)' : 'rgba(255,121,142,0.12)'};animation-delay:${i*0.05}s;animation-fill-mode:both">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
                        <div>
                            <span class="page-path" style="font-size:14px">${p.path}</span>
                            <span style="font-size:11px;color:var(--muted);margin-left:8px">${p.url}</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:14px">
                            <div style="text-align:center"><div style="font-size:10px;color:var(--muted);font-weight:600">BEFORE</div><div style="font-size:24px;font-weight:800;color:${p.score_before >= 70 ? 'var(--yellow)' : 'var(--pink)}'}">${p.score_before}</div></div>
                            <div style="font-size:22px;color:var(--lime)">â†’</div>
                            <div style="text-align:center"><div style="font-size:10px;color:var(--muted);font-weight:600">AFTER</div><div style="font-size:24px;font-weight:800;color:${p.score_after >= 70 ? 'var(--lime)' : 'var(--yellow)}'}">${p.score_after}</div></div>
                            <span class="badge badge-green" style="font-size:13px;padding:5px 14px;font-weight:800">+${p.score_after - p.score_before}%</span>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:12px">
                        <div><div style="font-size:10px;color:var(--pink);margin-bottom:4px;font-weight:700;letter-spacing:1px">META TITLE â€” BEFORE</div><div class="before-box" style="color:var(--muted);font-style:italic">${p.title_before || '(empty â€” missing!)'}</div></div>
                        <div><div style="font-size:10px;color:var(--lime);margin-bottom:4px;font-weight:700;letter-spacing:1px">META TITLE â€” AFTER âœ“</div><div class="after-box">${p.title_after || p.title_before || '(no change)'}</div></div>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
                        <div><div style="font-size:10px;color:var(--pink);margin-bottom:4px;font-weight:700;letter-spacing:1px">META DESC â€” BEFORE</div><div class="before-box" style="color:var(--muted);font-style:italic">${p.desc_before || '(empty â€” missing!)'}</div></div>
                        <div><div style="font-size:10px;color:var(--lime);margin-bottom:4px;font-weight:700;letter-spacing:1px">META DESC â€” AFTER âœ“</div><div class="after-box">${p.desc_after || p.desc_before || '(no change)'}</div></div>
                    </div>
                </div>
            `).join("")}

            ${projectData.agent_logs ? `
                <div class="card" style="margin-top:20px">
                    <div class="section-title">ğŸ¤– Agent Activity Log</div>
                    ${(projectData.agent_logs||[]).map(l => `<div class="log-entry"><span class="log-agent" style="color:${l.agent==='Planner'?'var(--blue)':l.agent==='Auditor'?'var(--yellow)':l.agent==='Fixer'?'var(--green)':'var(--pink)'}">${l.agent}</span><span style="color:var(--muted)">${l.message}</span></div>`).join("")}
                </div>
            ` : ''}
        </div>
    `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIX / DECIDE / REVIEW SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFix() {
    if (!projectData) { document.getElementById("mainContent").innerHTML = '<div class="card" style="text-align:center;padding:60px;color:var(--muted)">No data. Run a crawl first.</div>'; return; }
    const pages = projectData.pages || [];
    document.getElementById("mainContent").innerHTML = `
        <div class="fade-up">
            <h2 style="font-size:24px;font-weight:900;margin-bottom:24px;letter-spacing:-0.5px">ğŸ”§ Auto Fix Details</h2>
            ${pages.filter(p => p.fixes?.length > 0).map(p => `
                <div class="card" style="margin-bottom:12px">
                    <div class="page-path" style="margin-bottom:10px;font-size:14px">${p.path}</div>
                    ${(p.fixes||[]).map(f => `<div style="font-size:12px;padding:6px 0;border-bottom:1px solid rgba(209,255,121,0.04)"><span style="color:var(--lime)">âœ“</span> <strong>${f.type}</strong>: <span style="color:var(--muted)">${f.before||'(empty)'}</span> â†’ <span style="color:var(--lime)">${f.after||'Fixed'}</span></div>`).join("")}
                </div>
            `).join("") || '<div class="card" style="color:var(--muted);padding:40px;text-align:center">No fixes applied yet.</div>'}
        </div>
    `;
}

function renderDecide() {
    if (!projectData) { document.getElementById("mainContent").innerHTML = '<div class="card" style="text-align:center;padding:60px;color:var(--muted)">No data.</div>'; return; }
    const pages = projectData.pages || [];
    const escalated = pages.filter(p => p.escalations?.length > 0);
    document.getElementById("mainContent").innerHTML = `
        <div class="fade-up">
            <h2 style="font-size:24px;font-weight:900;margin-bottom:24px;letter-spacing:-0.5px">ğŸ¤” Items Needing Your Decision</h2>
            ${escalated.map(p => `
                <div class="card" style="margin-bottom:12px">
                    <div class="page-path" style="margin-bottom:10px;font-size:14px">${p.path}</div>
                    ${(p.escalations||[]).map((e,i) => `
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,234,121,0.04)">
                            <span style="font-size:12px"><span style="color:var(--yellow)">âš </span> ${e.reason || e.issue?.description || 'Needs review'}</span>
                            <div style="display:flex;gap:6px">
                                <button class="btn btn-sm" style="background:rgba(209,255,121,0.1);color:var(--lime)" onclick="handleDecision(${p.id},${i},'approve')">âœ“ Approve</button>
                                <button class="btn btn-sm" style="background:rgba(255,121,142,0.1);color:var(--pink)" onclick="handleDecision(${p.id},${i},'skip')">âœ— Skip</button>
                            </div>
                        </div>
                    `).join("")}
                </div>
            `).join("") || '<div class="card" style="color:var(--muted);padding:40px;text-align:center">Nothing escalated â€” all handled automatically!</div>'}
        </div>
    `;
}

async function handleDecision(pageId, issueIndex, action) {
    try {
        await api("/api/projects/" + currentProject + "/decide", {
            method: "POST", body: JSON.stringify({ page_id: pageId, issue_index: issueIndex, action })
        });
        const res = await api("/api/projects/" + currentProject);
        projectData = await res.json();
        renderDecide();
    } catch(e) { console.error(e); }
}

function renderReview() {
    if (!projectData) { document.getElementById("mainContent").innerHTML = '<div class="card" style="text-align:center;padding:60px;color:var(--muted)">No data.</div>'; return; }
    document.getElementById("mainContent").innerHTML = `
        <div class="fade-up">
            <h2 style="font-size:24px;font-weight:900;margin-bottom:24px;letter-spacing:-0.5px">ğŸ“‹ Review Validation</h2>
            <div class="card card-highlight">
                ${["Meta titles within character limits","Brand messaging preserved","Legal content unchanged","All escalations documented","Schema markup validated","Canonical URLs verified"].map(c => `<div class="check-item"><span style="color:var(--lime)">âœ“</span> ${c}</div>`).join("")}
            </div>
        </div>
    `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadReport() {
    try { const res = await api("/api/projects/" + currentProject + "/report"); reportData = await res.json(); showScreen("report"); } catch(e) { console.error(e); }
}

function renderReport() {
    if (!reportData && !projectData) { document.getElementById("mainContent").innerHTML = '<div class="card" style="text-align:center;padding:60px;color:var(--muted)">No data.</div>'; return; }
    const r = reportData || projectData;
    const summary = r.summary || { total_pages: r.total_pages, total_issues: r.total_issues, auto_fixed: r.auto_fixed, escalated: r.escalated, score_before: r.avg_score_before, score_after: r.avg_score_after, improvement: (r.avg_score_after||0) - (r.avg_score_before||0) };
    const pages = r.pages || [];
    const opportunities = r.opportunities || [];

    document.getElementById("mainContent").innerHTML = `
        <div class="fade-up">
            <h2 style="font-size:24px;font-weight:900;margin-bottom:28px;letter-spacing:-0.5px">ğŸ“„ Final SEO Audit Report</h2>
            <div class="card card-highlight card-glow neon-border" style="text-align:center;margin-bottom:28px">
                <div style="font-size:20px;font-weight:900;color:var(--lime);margin-bottom:4px">â—† SEO Agent Report</div>
                <div style="font-size:12px;color:var(--muted);margin-bottom:24px">${r.url || ''} Â· ${new Date().toLocaleDateString()}</div>
                <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:14px">
                    ${[
                        {l:"Pages",v:summary.total_pages,c:"var(--blue)"},{l:"Issues",v:summary.total_issues,c:"var(--pink)"},
                        {l:"Auto-Fixed",v:summary.auto_fixed,c:"var(--lime)"},{l:"Escalated",v:summary.escalated,c:"var(--yellow)"},
                        {l:"Score Î”",v:"+"+Math.round(summary.improvement||0)+"%",c:"var(--lime)"}
                    ].map(s => '<div><div style="font-size:28px;font-weight:800;color:'+s.c+';letter-spacing:-1px">'+s.v+'</div><div style="font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1.5px;font-weight:600">'+s.l+'</div></div>').join("")}
                </div>
            </div>
            <div class="two-col" style="margin-bottom:28px">
                <div class="card">
                    <div class="section-title" style="color:var(--lime)">Actions Taken</div>
                    ${pages.filter(p => p.fixes?.length > 0).slice(0,6).map(p => '<div style="margin-bottom:12px"><div class="page-path" style="margin-bottom:4px">'+p.path+'</div>'+(p.fixes||[]).map(f => '<div style="font-size:12px;color:var(--lime);padding-left:12px">âœ“ '+f.type+': '+(f.after||'Fixed')+'</div>').join("")+'</div>').join("") || '<div style="color:var(--muted);font-size:13px">No fixes applied</div>'}
                </div>
                <div class="card">
                    <div class="section-title" style="color:var(--yellow)">Escalated</div>
                    ${pages.filter(p => p.escalations?.length > 0).slice(0,6).map(p => '<div style="margin-bottom:12px"><div class="page-path" style="margin-bottom:4px">'+p.path+'</div>'+(p.escalations||[]).map(e => '<div style="font-size:12px;color:var(--yellow);padding-left:12px">âš  '+(e.reason||'Needs review')+'</div>').join("")+'</div>').join("") || '<div style="color:var(--muted);font-size:13px">Nothing escalated</div>'}
                </div>
            </div>
            ${opportunities.length ? '<div class="card"><div class="section-title" style="color:var(--blue)">SEO Opportunities</div>'+opportunities.map(o => '<div class="opportunity"><span style="color:var(--blue)">ğŸ’¡</span> '+o+'</div>').join("")+'</div>' : ''}
            <div class="verdict">
                <div class="verdict-text">"${r.verdict || "This agent doesn't just generate SEO suggestions. It decides, executes, and knows when to stop."}"</div>
                <div class="verdict-sub">Powered by Autonomous Multi-Agent Architecture Â· Planner â†’ Auditor â†’ Fixer â†’ Reviewer</div>
            </div>
        </div>
    `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function showModule(moduleId) {
    if (!currentProject) {
        document.getElementById("mainContent").innerHTML = '<div class="fade-up"><button class="btn btn-secondary btn-sm" onclick="showScreen(\'dashboard\')" style="margin-bottom:20px">â† Back</button><div class="card" style="text-align:center;padding:60px;color:var(--muted)">Run a crawl first to see module data.</div></div>';
        return;
    }
    try {
        const res = await api("/api/projects/" + currentProject + "/modules/" + moduleId);
        if (!res.ok) throw new Error("Module not available");
        const data = await res.json();
        const metrics = data.metrics || {};
        const metricColors = ["var(--lime)","var(--blue)","var(--yellow)","var(--pink)","var(--orange)","var(--green)"];
        document.getElementById("mainContent").innerHTML = `
            <div class="fade-up">
                <button class="btn btn-secondary btn-sm" onclick="showScreen('dashboard')" style="margin-bottom:20px">â† Back</button>
                <h2 style="font-size:24px;font-weight:900;margin-bottom:4px;letter-spacing:-0.5px">${data.module}</h2>
                <p style="color:var(--muted);font-size:13px;margin-bottom:28px">Analysis based on crawled data</p>
                <div class="three-col">
                    ${Object.entries(metrics).map(([key, val], i) => `
                        <div class="card scale-in stagger-${i+1}" style="text-align:center;animation-fill-mode:both">
                            <div class="label">${key.replace(/_/g, ' ')}</div>
                            <div class="score-number" style="font-size:40px;margin-top:12px;color:${typeof val === 'number' && val >= 70 ? metricColors[i%6] : typeof val === 'number' && val >= 40 ? 'var(--yellow)' : typeof val === 'number' ? 'var(--pink)' : metricColors[i%6]}">${val}</div>
                        </div>
                    `).join("")}
                </div>
            </div>
        `;
    } catch(e) {
        document.getElementById("mainContent").innerHTML = '<div class="card" style="color:var(--pink);padding:30px">Error loading module: '+e.message+'</div>';
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
document.getElementById("passwordInput").addEventListener("keydown", e => { if (e.key === "Enter") handleAuth(); });
</script>
</body>
</html>